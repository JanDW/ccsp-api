# CSSP Mock API

This repository contains the code for generating the mock API the [ccsp-experiment](https://github.com/JanDW/ccsp-ui/) prototype depends on.

The [prototype runs on github pages](https://jandw.github.io/ccsp-ui/) but requires this API. It's currently running on my personal Heroku account at https://ccsp-api.herokuapp.com/ The API contains mock data generated with [faker.js](https://github.com/Marak/faker.js), so there are no privacy issues.

The following instructions assume you have `node.js` and `npm` installed on your system.

## Running the API locally

The API consists of an `api.json` file served with [json-server](https://github.com/typicode/json-server)

to run it on `localhost:3000`, type
```bash
npm run-script serve-api
```

`api.json` is generated by the `make-api.js` file, to regenerate type
```bash
npm run-script make-api
```

to regenerate and build in one step (live life to the fullest), you can execute
```bash
npm run-script make-api
```

- [ ] At the time of writing the API url is hardcoded to an Heroku app in ccsp-experiment.
I plan to let ccsp-experiment app look for the API at `localhost:3000`, when the app itself is served from localhost in the future.

The output in the terminal will show the available API resources (i.e. employees, spouses, children, applications, awards). For more information on what the API server can do, consult the [json-server README.md file](https://github.com/typicode/json-server). Spoiler alert: _pagination, filtering, search, routing, slicing, etc._ are available, as are the _GET, PUT, POST, PATCH, DELETE_ HTTP methods.

Operators can be tacked on as query parameters. E.g. This call to `employees` will return the third page (collection sliced by 10 items/page) of the collection with the "id referenced" _children_, _spouse_, and _applications_ items embedded in the JSON.

```
http://localhost:3000/employees?_embed=children&_embed=applications&_embed=spouses&_page=3
```


## Deploying the API to a Heroku account

1. Create an account on <br/>[https://heroku.com](https://heroku.com)

2. Install the Heroku CLI on your computer: <br/>[https://devcenter.heroku.com/articles/heroku-cli](https://devcenter.heroku.com/articles/heroku-cli)

3. Connect the Heroku CLI to your account by writing the following command in your terminal and follow the instructions on the command line:
```bash
heroku login
```
4. Then create a remote Heroku project
```bash
heroku create
```
 This will create a project on Heroku with a random name. If you want to name your app you have to supply a name:
```bash
heroku create app-name
```

5. Add the heroku remote to your clone of this repository (substitute `app-name` with your choice)

```bash
git remote add origin https://git.heroku.com/app-name.git
```

I added this repository as well (assuming you're using SSH instead of HTTPS)

```bash
git remote add mit git@github.mit.edu:jandw/ccsp-api.git
```

6. Check your remotes are properly set up

```bash
git remote -v
```

should output this in the terminal
```bash
mit	git@github.mit.edu:jandw/ccsp-api.git (fetch)
mit	git@github.mit.edu:jandw/ccsp-api.git (push)
origin	https://git.heroku.com/jans-test.git (fetch)
origin	https://git.heroku.com/jans-test.git (push)
```

7. If needed, build the API and commit it

```bash
npm run-script make-api && git add -A && git commit -m "API build"
```

8. Push the API to heroku

```bash
git push -u origin master
```
This also sets up tracking, so in the future, you should be able to just use `git push` to deploy. Next, push the changes to `github.mit.edu/jandw/ccsp-api`

```bash
git push mit master
```
You should see the push, followed by terminal output regarding the heroku build of the api

9. Visit the newly created app by opening it via heroku:
```bash
heroku open
```

10. If something went wrong, check the logs:
```bash
heroku logs --tail
```

11. To delete the herokuapp
```bash
heroku apps:destroy app-name
```
